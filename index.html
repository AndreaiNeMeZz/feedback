
                <!-- Navigazione -->
                <div id="navigation" class="bg-transparent px-8 py-4 flex justify-between items-center border-t border-gray-700/50 mt-4">
                    <button id="prevBtn" class="text-gray-300 font-semibold hover:text-white transition" data-lang-key="prev_btn">Indietro</button>
                    <button id="nextBtn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition transform hover:scale-105" data-lang-key="next_btn">Avanti</button>
                </div>
            </div>

            <!-- Schermata di Risposta -->
            <div id="response-screen" class="hidden text-center bg-transparent p-12">
                 <!-- Icona Successo -->
                 <div id="success-icon" class="hidden w-16 h-16 bg-green-100 text-green-600 rounded-full items-center justify-center mx-auto mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                 </div>
                 <!-- Icona Errore -->
                 <div id="error-icon" class="hidden w-16 h-16 bg-red-100 text-red-600 rounded-full items-center justify-center mx-auto mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                 </div>
                 <!-- Spinner Caricamento -->
                 <div id="loading-spinner" class="hidden spinner mx-auto mb-6"></div>
                 
                 <h2 id="response-title" class="text-3xl font-bold text-white mb-2"></h2>
                 <p id="response-subtitle" class="text-gray-300 mb-8"></p>
                 <button id="resetBtn" class="text-blue-400 font-semibold hover:underline" data-lang-key="reset_btn">Invia un altro feedback</button>
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DIZIONARIO TRADUZIONI ---
            const translations = {
                it: {
                    lang_en: "English", main_title: "Il tuo parere è importante", main_subtitle: "Dedica un minuto a condividere la tua esperienza.",
                    step1_title: "Iniziamo...", company_name_label: "Nome Azienda Cliente", company_name_placeholder: "Es. Rossi S.p.A.",
                    exhibition_name_label: "Fiera di riferimento", exhibition_name_placeholder: "Es. Fiera del Mobile 2025",
                    step2_title: "Com'è andata l'esperienza generale?", overall_satisfaction_label: "Soddisfazione Generale del Servizio",
                    very_satisfied: "Molto Soddisfatto", satisfied: "Soddisfatto", fairly_satisfied: "Abbastanza", not_satisfied: "Per nulla",
                    designer_experience_label: "Esperienza con il nostro Designer", excellent: "Eccellente", good: "Buona", fair: "Sufficiente", poor: "Scarsa",
                    step3_title: "Valuta alcuni aspetti specifici...", design_quality_label: "Qualità Progettazione", meeting_needs_label: "Rispondenza Esigenze",
                    deadlines_label: "Rispetto Tempistiche", recommend_label: "Probabilità di Raccomandarci", not_likely: "Per nulla probabile", extremely_likely: "Estremamente probabile",
                    step4_title: "Ultime domande...", experience_feedback_label: "Cosa ti è piaciuto di più della nostra collaborazione?",
                    improvement_feedback_label: "C'è qualcosa che potremmo migliorare?", your_answer_placeholder: "La tua risposta...",
                    suggestion_placeholder: "Ogni suggerimento è prezioso...", prev_btn: "Indietro", next_btn: "Avanti", submit_btn: "Invia",
                    thanks_title: "Grazie!", thanks_subtitle: "Il tuo feedback è stato inviato. Ci aiuterà a migliorare ancora.",
                    reset_btn: "Invia un altro feedback", submission_loading: "Invio in corso...",
                    error_title: "Errore", error_subtitle: "Non è stato possibile inviare il tuo feedback. Riprova più tardi."
                },
                en: {
                    lang_it: "Italiano", main_title: "Your opinion is important", main_subtitle: "Take a minute to share your experience.",
                    step1_title: "Let's start...", company_name_label: "Company Name", company_name_placeholder: "E.g. Smith Inc.",
                    exhibition_name_label: "Exhibition Name", exhibition_name_placeholder: "E.g. Design Fair 2025",
                    step2_title: "How was the overall experience?", overall_satisfaction_label: "Overall Service Satisfaction",
                    very_satisfied: "Very Satisfied", satisfied: "Satisfied", fairly_satisfied: "Fairly", not_satisfied: "Not at all",
                    designer_experience_label: "Experience with our Designer", excellent: "Excellent", good: "Good", fair: "Fair", poor: "Poor",
                    step3_title: "Please rate some specific aspects...", design_quality_label: "Design Quality", meeting_needs_label: "Meeting of Needs",
                    deadlines_label: "Meeting of Deadlines", recommend_label: "Likelihood to Recommend", not_likely: "Not at all likely", extremely_likely: "Extremely likely",
                    step4_title: "Last questions...", experience_feedback_label: "What did you like most about our collaboration?",
                    improvement_feedback_label: "Is there anything we could improve?", your_answer_placeholder: "Your answer...",
                    suggestion_placeholder: "Every suggestion is valuable...", prev_btn: "Back", next_btn: "Next", submit_btn: "Submit",
                    thanks_title: "Thank you!", thanks_subtitle: "Your feedback has been submitted. It will help us improve.",
                    reset_btn: "Submit another feedback", submission_loading: "Submitting...",
                    error_title: "Error", error_subtitle: "Could not submit your feedback. Please try again later."
                }
            };
            
            let currentLang = 'it';
            const langSwitchBtn = document.getElementById('lang-switch');

            function setLanguage(lang) {
                currentLang = lang;
                document.documentElement.lang = lang;
                langSwitchBtn.innerHTML = `<span data-lang-key="${lang === 'it' ? 'lang_en' : 'lang_it'}">${translations[lang][lang === 'it' ? 'lang_en' : 'lang_it']}</span>`;
                document.querySelectorAll('[data-lang-key]').forEach(el => {
                    const key = el.dataset.langKey;
                    if (translations[lang][key]) el.textContent = translations[lang][key];
                });
                document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                    const key = el.dataset.langPlaceholder;
                    if (translations[lang][key]) el.placeholder = translations[lang][key];
                });
                updateButtons();
            }

            langSwitchBtn.addEventListener('click', () => setLanguage(currentLang === 'it' ? 'en' : 'it'));

            // --- LOGICA DEL WIZARD ---
            const steps = document.querySelectorAll('.form-step');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const progressBar = document.getElementById('progress-bar');
            const form = document.getElementById('wizardForm');
            const surveyContainer = document.getElementById('survey-container');
            const responseScreen = document.getElementById('response-screen');
            const resetBtn = document.getElementById('resetBtn');

            let currentStep = 0;
            const totalSteps = steps.length;

            function updateButtons() {
                prevBtn.style.visibility = (currentStep === 0) ? 'hidden' : 'visible';
                nextBtn.textContent = (currentStep === totalSteps - 1) ? translations[currentLang].submit_btn : translations[currentLang].next_btn;
            }
            
            function updateProgressBar() {
                progressBar.style.width = `${((currentStep + 1) / totalSteps) * 100}%`;
            }

            function showStep(stepIndex) {
                steps.forEach((step, index) => step.classList.toggle('active', index === stepIndex));
                currentStep = stepIndex;
                updateButtons();
                updateProgressBar();
            }

            function validateStep(stepIndex) {
                const currentStepElement = steps[stepIndex];
                const inputs = currentStepElement.querySelectorAll('input[required], textarea[required]');
                let isValid = true;
                inputs.forEach(input => {
                    if ((input.type === 'text' || input.tagName.toLowerCase() === 'textarea') && !input.value.trim()) {
                        isValid = false;
                        input.classList.add('border-red-500', 'focus:ring-red-500');
                    } else {
                        input.classList.remove('border-red-500', 'focus:ring-red-500');
                    }
                });
                const fieldsets = currentStepElement.querySelectorAll('fieldset');
                fieldsets.forEach(fieldset => {
                    const radio = fieldset.querySelector('input[type="radio"][required]');
                    if (radio && !form.querySelector(`input[name="${radio.name}"]:checked`)) {
                        isValid = false;
                        fieldset.classList.add('border', 'border-red-500', 'rounded-lg', 'p-2', 'bg-red-50');
                    } else if (radio) {
                        fieldset.classList.remove('border', 'border-red-500', 'rounded-lg', 'p-2', 'bg-red-50');
                    }
                });
                return isValid;
            }

            function showResponseScreen(state) {
                surveyContainer.style.display = 'none';
                responseScreen.style.display = 'block';

                document.getElementById('success-icon').style.display = 'none';
                document.getElementById('error-icon').style.display = 'none';
                document.getElementById('loading-spinner').style.display = 'none';

                const title = document.getElementById('response-title');
                const subtitle = document.getElementById('response-subtitle');

                switch (state) {
                    case 'loading':
                        document.getElementById('loading-spinner').style.display = 'block';
                        title.textContent = translations[currentLang].submission_loading;
                        subtitle.textContent = '...';
                        resetBtn.style.display = 'none';
                        break;
                    case 'success':
                        document.getElementById('success-icon').style.display = 'flex';
                        title.textContent = translations[currentLang].thanks_title;
                        subtitle.textContent = translations[currentLang].thanks_subtitle;
                        resetBtn.style.display = 'inline-block';
                        break;
                    case 'error':
                        document.getElementById('error-icon').style.display = 'flex';
                        title.textContent = translations[currentLang].error_title;
                        subtitle.textContent = translations[currentLang].error_subtitle;
                        resetBtn.style.display = 'inline-block';
                        break;
                }
            }

            async function submitFormToSheetDB() {
                // *** LINK API DI SHEETDB ***
                const SHEETDB_API_URL = "https://sheetdb.io/api/v1/3m1ymae26ksx5?sheet=Risposte_del_modulo_FEEDBACK";

                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                
                // Aggiunge la data e la lingua al momento dell'invio
                data.submittedAt = new Date().toLocaleString("it-IT", { timeZone: "Europe/Rome" });
                data.language = currentLang;

                try {
                    const response = await fetch(SHEETDB_API_URL, {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            data: [data] // SheetDB si aspetta un array di oggetti
                        })
                    });

                    if (response.ok) {
                        console.log("Dati inviati con successo a SheetDB.");
                        showResponseScreen('success');
                    } else {
                        const errorData = await response.json();
                        console.error("Errore durante l'invio a SheetDB:", errorData);
                        showResponseScreen('error');
                    }
                } catch (e) {
                    console.error("Errore di rete o di fetch:", e);
                    showResponseScreen('error');
                }
            }

            nextBtn.addEventListener('click', async () => {
                if (!validateStep(currentStep)) return;
                if (currentStep < totalSteps - 1) {
                    showStep(currentStep + 1);
                } else {
                    showResponseScreen('loading');
                    await submitFormToSheetDB();
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentStep > 0) showStep(currentStep - 1);
            });
            
            resetBtn.addEventListener('click', () => {
                form.reset();
                responseScreen.style.display = 'none';
                surveyContainer.style.display = 'block';
                showStep(0);
            });

            setLanguage('it');
        });
    </script>
</body>
</html>
